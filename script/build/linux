#!/bin/bash

set -ex

./script/clean

TMP_CONTAINER="tmpcontainer"
TAG="docker/compose:tmp-glibc-linux-binary"
DOCKER_COMPOSE_GITSHA=$(script/build/write-git-sha)

docker build -t "${TAG}" . \
       --build-arg BUILD_PLATFORM=debian \
       --build-arg GIT_COMMIT=${DOCKER_COMPOSE_GITSHA}
docker create --name ${TMP_CONTAINER} ${TAG}
mkdir -p dist
docker cp ${TMP_CONTAINER}:/usr/local/bin/docker-compose dist/docker-compose-Linux-x86_64
docker container rm -f ${TMP_CONTAINER}
docker image rm -f ${TAG}
